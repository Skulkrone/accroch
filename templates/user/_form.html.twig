<section id="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-6 col-sm-offset-4 col-md-6 col-md-offset-3">
                <div class="page-login-form box">
                    <form name="user" method="post" id="upload-form" enctype="multipart/form-data">
                        <div class="form-group"><label for="user_Name" class="form-control-label required">Nom</label><input type="text" id="user_Name" name="user[Name]" required="required" class="form-control" value="Baron"><span class="material-input"></span></div>
                        <div class="form-group"><label for="user_firstName" class="form-control-label required">Prénom</label><input type="text" id="user_firstName" name="user[firstName]" required="required" class="form-control" value="Laurent"><span class="material-input"></span></div>
                        <div class="form-group"><label for="user_username" class="form-control-label required">Login</label><input type="text" id="user_username" name="user[username]" required="required" class="form-control" value="skulkrone"><span class="material-input"></span></div>
                        <div class="form-group"><label for="user_address" class="form-control-label required">Adresse</label><input type="text" id="user_address" name="user[address]" required="required" class="form-control" value="12 Allee des ducs de Savoie"><span class="material-input"></span></div>
                        <div style="display: none;">
                            <select id="countrySelect" name="country">
                                <option value="FR"> France</option>
                            </select>
                        </div>
                        <div class="form-group"><label for="user_postalCode" class="form-control-label required">Code Postal</label><input type="text" id="user_postalCode" name="user[postalCode]" required="required" onblur="postalCodeLookup();" class="form-control" value="74600"><span class="material-input"></span></div>
                        <div class="form-group"><label for="user_city" class="form-control-label required">Ville</label><input type="text" id="user_city" name="user[city]" required="required" onblur="closeSuggestBox();" class="form-control" value="Seynod"><span class="material-input"></span></div>
                        <span style="z-index:25;visibility: hidden;" id="suggestBoxElement"></span>
                        <div class="form-group"><label for="user_email" class="form-control-label required">Email</label><input type="email" id="user_email" name="user[email]" required="required" class="form-control" value="laurentbaron80@gmail.com"><span class="material-input"></span></div>
                        <div class="form-group"><label for="user_phone" class="form-control-label required">Téléphone</label><input type="text" id="user_phone" name="user[phone]" required="required" class="form-control" value="629980266"><span class="material-input"></span></div>
                        <div class="form-group is-empty"><label for="user_password_first" class="form-control-label required">Mot de passe</label><input type="password" id="user_password_first" name="user[password][first]" required="required" class="form-control"><span class="material-input"></span></div>
                        <div class="form-group is-empty"><label for="user_password_second" class="form-control-label required">Répéter Mot de passe</label><input type="password" id="user_password_second" name="user[password][second]" required="required" class="form-control"><span class="material-input"></span></div>
                        <div class="form-group">
                            <div class="custom-file"><input type="file" id="user_avatar" name="user[avatar]" class="custom-file-input"><label for="user_avatar" class="custom-file-label">Avatar</label></div>
                        </div>

                        <fieldset class="form-group"><legend class="col-form-label">vous êtes : </legend><div id="user_typeRoles"><div class="form-check">        
                                    <input type="radio" id="user_typeRoles_0" name="user[typeRoles]" class="form-check-input" value="2">
                                    <label class="form-check-label" for="user_typeRoles_0">Utilisateur</label></div><div class="form-check">        <input type="radio" id="user_typeRoles_1" name="user[typeRoles]" class="form-check-input" value="3">
                                    <label class="form-check-label" for="user_typeRoles_1">Annonceur</label></div></div></fieldset>
                        <div class="form-group"><div class="form-check">        <input type="checkbox" id="user_termsAccepted" name="user[termsAccepted]" required="required" class="form-check-input" value="1">
                                <label class="form-check-label required" for="user_termsAccepted">En créant votre compte, vous acceptez l'intégralité de nos 
                                    <a href="{{ path('CGV') }}">Conditions générales de vente et d'utilisation</a>.</label></div></div>
                        <!--<input type="submit" name="upload" class="btn" value="S'inscrire !">-->
                        <button class="btn btn-common log-btn">Mettre à jour</button>
                        <input type="hidden" id="user__token" name="user[_token]" value="HAYG_2LZP-jTf4wg8I-psezkpKrZi1abMcfAhVP3quw">
                    </form>
                    <p style="color: #000;font-weight: 700;">Informations sur le traitement de vos données personnelles : Pour connaitre et exercer vos droits, notamment de retrait de votre consentement à l'utilisation des données collectées par ce formulaire, veuillez consulter nos <a href="{{ path('mentions_legales') }}">Mentions Légales</a>.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<script type="text/javascript" src="http://api.geonames.org/export/geonamesData.js?username=skulkrone"></script>
<script type="text/javascript" src="{{ asset('assets/js/jsr_class.js')}}"></script>
<script type="text/javascript" >
    // les codes postaux sont remplis par le callback JSON et utilisés par les gestionnaires d'événements de la souris de la boîte de suggestion
    var postalcodes;

    // Cette fonction sera appelée par notre callback JSON
    // le paramètre jData contiendra un tableau avec les objets du code postal
    function getLocation(jData) {
        if (jData === null) {
            // Il y a eu un problème d'analyse des résultats de recherche
            return;
        }

        // sauvegarder le tableau des lieux dans'codes postaux' pour le rendre accessible depuis les gestionnaires d'événements de la souris
        postalcodes = jData.postalcodes;

        if (postalcodes.length > 1) {
            // nous avons plusieurs endroits pour le code postal
            // rendre visible la boîte à suggestions
            document.getElementById('suggestBoxElement').style.visibility = 'visible';
            var suggestBoxHTML = '';
            // itérez sur les lieux et construisez le contenu de la boîte à suggestions
            for (i = 0; i < jData.postalcodes.length; i++) {
                // pour chaque enregistrement de code postal, nous créons une div html 
                // chaque div obtient un identifiant à l'aide de l'index du tableau pour une récupération ultérieure 
                // Définir les gestionnaires d'événements de la souris pour mettre en surbrillance les endroits sur le survol de la souris
                // et pour sélectionner un endroit, cliquez sur
                // tous les événements reçoivent l'index du tableau de codes postaux comme paramètre d'entrée

                suggestBoxHTML += "<div class='suggestions' id=pcId" + i + " onmousedown='suggestBoxMouseDown(" + i + ")' onmouseover='suggestBoxMouseOver(" + i + ")' onmouseout='suggestBoxMouseOut(" + i + ")'> " + postalcodes[i].countryCode + ' ' + postalcodes[i].postalcode + '    ' + postalcodes[i].placeName + '</div>';
            }
            // display suggest box
            document.getElementById('suggestBoxElement').innerHTML = suggestBoxHTML;
        } else {
            if (postalcodes.length === 1) {
                // exactement un seul endroit pour le code postal
                // Remplissez directement le formulaire, aucune boîte de suggestions n'est requise. 
                var placeInput = document.getElementById("user_city");
                placeInput.value = postalcodes[0].placeName;
            }
            closeSuggestBox();
        }
    }


    function closeSuggestBox() {
        document.getElementById('suggestBoxElement').innerHTML = '';
        document.getElementById('suggestBoxElement').style.visibility = 'hidden';
    }


    // supprimer le surlignage lors de l'événement mouse out
    function suggestBoxMouseOut(obj) {
        document.getElementById('pcId' + obj).className = 'suggestions';
    }

    // l'utilisateur a sélectionné un nom de lieu dans la boîte de suggestion
    function suggestBoxMouseDown(obj) {
        closeSuggestBox();
        var placeInput = document.getElementById("user_city");
        placeInput.value = postalcodes[obj].placeName;
    }

    // pour mettre en surbrillance les lieux d'un événement survolé par la souris
    function suggestBoxMouseOver(obj) {
        document.getElementById('pcId' + obj).className = 'suggestionMouseOver';
    }


    // cette fonction est appelée lorsque l'utilisateur quitte le champ de saisie du code postal
    // il appelle le webservice geonames.org JSON pour récupérer un tableau de lieux 
    // pour le code postal indiqué 
    function postalCodeLookup() {

        var country = document.getElementById("countrySelect").value;

        if (geonamesPostalCodeCountries.toString().search(country) == -1) {
            return; // pays sélectionné non supporté par geonames
        }
        // affichage du 'chargement' dans la boîte de suggestions
        document.getElementById('suggestBoxElement').style.visibility = 'visible';
        document.getElementById('suggestBoxElement').innerHTML = '<small><i>loading ...</i></small>';

        var postalcode = document.getElementById("user_postalCode").value;

        request = 'http://api.geonames.org/postalCodeLookupJSON?postalcode=' + postalcode + '&country=' + country + '&callback=getLocation&username=skulkrone';

        // Créer un nouvel objet script
        aObj = new JSONscriptRequest(request);
        // Construire la balise script
        aObj.buildScriptTag();
        // Exécuter (ajouter) la balise script
        aObj.addScriptTag();
    }

    // définir le pays de l'ip de l'utilisateur (inclus dans geonamesData.js) comme pays sélectionné 
    // dans le pays sélectionner la case du formulaire d'adresse
    function setDefaultCountry() {
        var countrySelect = document.getElementById("countrySelect");
        for (i = 0; i < countrySelect.length; i++) {
            // le javascript geonamesDataData.js contient le code pays
            //de l'UserIp dans la variable'geonamesUserIpCountryCode'.
            if (countrySelect[i].value === geonamesUserIpCountryCode) {
                // définir la zone de sélection du pays
                countrySelect.selectedIndex = i;
            }
        }
    }
</script>


